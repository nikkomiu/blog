{{ define "main" }}
  <article class="post mt-8">
    <div class="md:flex items-start">
      {{ partial "cover.html" . }}

      <div class="flex flex-col md:ml-6">
        <h1 class="post-title flex" style="margin-top:0">
          <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a>
        </h1>

        {{ if .Params.tags }}
          <span class="post-tags">
            {{ range .Params.tags }}
              #<a
                href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}"
                data-pagefind-filter="tag"
                >{{ . }}</a
              >&nbsp;
            {{ end }}
          </span>
        {{ end }}

        {{ if (.Params.Toc | default .Site.Params.Toc) }}
          <div class="table-of-contents">
            <h2>
              {{ (.Params.TocTitle | default .Site.Params.TocTitle) | default "Table of Contents" }}
            </h2>
            {{ .TableOfContents }}
          </div>
        {{ end }}

        <div class="post-content mt-2">
          {{- with .Content -}}
            <div>
              {{ . | replaceRE "(<h[1-9] id=\"([^\"]+)\".+)(</h[1-9]+>)" `${1}<a href="#${2}" class="hanchor" ariaLabel="Anchor">&#8983;</a> ${3}` | safeHTML }}
            </div>
          {{- end -}}
        </div>
      </div>
    </div>

    {{ if eq .Type $.Site.Params.contentTypeName }}
      {{ partial "posts_pagination.html" . }}
    {{ end }}

    <div class="author-list-group">
      {{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
      {{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}
      {{ $pages := where (where $.Site.Pages "Type" "in" $contentTypeName) "Params.Author" "==" .Title }}
      {{ if $pages }}
        <div class="list">
          <h3 class="list-heading">Latest Posts</h3>

          {{ $postContext := dict "Pages" $pages "Parent" . }}
          {{ partial "post-list.html" $postContext }}
        </div>
      {{ end }}

      {{ $pages = where (where $.Site.Pages "Type" "in" "notes") "Params.Author" "==" .Title }}
      {{ if $pages }}
        <div class="list">
          <h3 class="list-heading">Recent Notes</h3>

          {{ $postContext := dict "Pages" $pages "Parent" . }}
          {{ partial "post-list.html" $postContext }}
        </div>
      {{ end }}
    </div>

    {{ if not (.Params.hideComments | default false) }}
      {{ partial "comments.html" . }}
    {{ end }}
  </article>
{{ end }}
